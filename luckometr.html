<!DOCTYPE html>
<html>
<head>
    <title>Modern Slot Machine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF4D4D;
            --secondary: #4ECCA3;
            --accent: #45B7D1;
            --dark: #1a1a1a;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
			display: flex;
			flex-direction: column;
			align-items: center;
			min-height: 100vh;
			background: linear-gradient(45deg, var(--dark), #2d2d2d);
			font-family: 'Poppins', sans-serif;
			padding: 20px;
			position: relative;
			overflow-y: auto; /* Разрешаем вертикальную прокрутку */
			overflow-x: hidden; /* Запрещаем горизонтальную прокрутку */
		}
		.back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .bet-selector {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .bet-label {
            color: white;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .bet-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .bet-option {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bet-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .bet-option.active {
            background: var(--primary);
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        .bet-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
		/* Базовые настройки для мобильных устройств */
		@media screen and (max-aspect-ratio: 9/16) {
			body {
				padding: 10px;
				min-height: 100vh;
				justify-content: flex-start;
				gap: 15px;
			}

			.title {
				font-size: 1.8rem;
				margin-top: 60px; /* Отступ для кнопки "назад" */
			}

			.user-name {
				font-size: 1rem;
				margin: 5px 0;
			}

			.balance {
				font-size: 1.2rem;
				padding: 10px 15px;
				margin-bottom: 10px;
			}
			.content-wrapper {
				width: 100%;
				max-width: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				padding-bottom: 20px; /* Отступ снизу */
			}
			.slot-machine {
				margin: 20px auto; /* Центрирование и отступы */
				width: 90%; /* Ширина относительно экрана */
				max-width: 400px; /* Максимальная ширина */
			}

			.reels {
				gap: 8px;
				margin-bottom: 15px;
			}

			.reel {
				width: 60px;
				height: 60px;
			}

			.symbol {
				font-size: 30px;
				height: 60px;
			}

			.buttons {
				gap: 8px;
			}

			.spin-button, .auto-spin-button {
				padding: 12px;
				font-size: 14px;
			}

			.result {
				font-size: 16px;
				margin-top: 10px;
			}

			.spins-left {
				font-size: 14px;
				margin-top: 8px;
			}

			.timer {
				padding: 10px;
				margin-top: 10px;
			}

			.timer-text {
				font-size: 14px;
			}

			.countdown {
				font-size: 16px;
			}

			.bet-selector {
				padding: 10px;
			}

			.bet-options {
				gap: 5px;
			}

			.bet-option {
				padding: 8px 12px;
				font-size: 12px;
			}

			.current-bet-info {
				font-size: 14px;
				padding: 8px;
				margin-bottom: 10px;
			}

			/* Уменьшаем размер кнопки "назад" */
			.back-button {
				padding: 8px 15px;
				font-size: 14px;
				top: 10px;
				left: 10px;
			}
		}

		/* Дополнительные настройки для очень узких экранов */
		@media screen and (max-aspect-ratio: 9/16) and (max-width: 320px) {
			.reel {
				width: 50px;
				height: 50px;
			}

			.symbol {
				font-size: 25px;
				height: 50px;
			}

			.spin-button, .auto-spin-button {
				padding: 10px;
				font-size: 12px;
			}

			.bet-option {
				padding: 6px 10px;
				font-size: 11px;
			}
		}

		/* Настройки для высоты экрана */
		@media screen and (max-height: 700px) and (max-aspect-ratio: 9/16) {
			.title {
				margin-top: 50px;
				font-size: 1.5rem;
			}

			body {
				gap: 10px;
			}

			.slot-machine {
				padding: 10px;
			}
		}

		/* Обеспечение минимальных отступов */
		@media screen and (max-height: 600px) and (max-aspect-ratio: 9/16) {
			.title {
				margin-top: 40px;
				font-size: 1.3rem;
			}

			.user-name {
				font-size: 0.9rem;
				margin: 3px 0;
			}

			.balance {
				font-size: 1.1rem;
				padding: 8px 12px;
				margin-bottom: 8px;
			}

			.reel {
				width: 45px;
				height: 45px;
			}

			.symbol {
				font-size: 22px;
				height: 45px;
			}

			.result {
				font-size: 14px;
				margin-top: 8px;
			}

			.spins-left {
				font-size: 12px;
				margin-top: 5px;
			}
		}

		/* Оптимизация для различных высот экрана */
		@media screen and (min-height: 700px) and (max-aspect-ratio: 9/16) {
			.slot-machine {
				margin-top: auto;
				margin-bottom: auto;
			}

			body {
				justify-content: space-between;
				padding: 20px 10px;
			}
		}

		/* Настройка отступов для безопасной зоны */
		@supports (padding: max(0px)) {
			body {
				padding-left: max(10px, env(safe-area-inset-left));
				padding-right: max(10px, env(safe-area-inset-right));
				padding-top: max(20px, env(safe-area-inset-top));
				padding-bottom: max(10px, env(safe-area-inset-bottom));
			}
		}

		/* Оптимизация для устройств с вырезами экрана */
		@supports (padding-top: constant(safe-area-inset-top)) {
			body {
				padding-top: constant(safe-area-inset-top);
				padding-bottom: constant(safe-area-inset-bottom);
				padding-left: constant(safe-area-inset-left);
				padding-right: constant(safe-area-inset-right);
			}
		}

		/* Настройка гибкого макета */
		.slot-machine {
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			min-height: 0;
			flex-shrink: 1;
		}

		/* Улучшение отзывчивости для кнопок */
		.buttons {
			display: flex;
			justify-content: space-between;
			gap: 8px;
			margin-top: auto;
		}

		/* Оптимизация для очень маленьких экранов */
		@media screen and (max-height: 500px) and (max-aspect-ratio: 9/16) {
			.title {
				font-size: 1.2rem;
				margin-top: 35px;
			}

			.balance {
				font-size: 1rem;
				padding: 5px 10px;
			}

			.reel {
				width: 40px;
				height: 40px;
			}

			.symbol {
				font-size: 20px;
				height: 40px;
			}

			.spin-button, .auto-spin-button {
				padding: 8px;
				font-size: 12px;
			}

			.result, .spins-left {
				font-size: 11px;
				margin-top: 4px;
			}

			.bet-selector {
				padding: 5px;
			}

			.bet-option {
				padding: 5px 8px;
				font-size: 10px;
			}
		}

		/* Улучшение читаемости текста */
		@media screen and (max-aspect-ratio: 9/16) {
			.result, .spins-left, .timer-text, .bet-label {
				text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
			}
		}

		/* Оптимизация анимаций для мобильных устройств */
		@media screen and (max-aspect-ratio: 9/16) {
			.symbol.winning {
				animation: rainbowGlow 1.5s linear infinite;
			}

			@keyframes rainbowGlow {
				0% { transform: scale(1); }
				50% { transform: scale(1.05); }
				100% { transform: scale(1); }
			}
		}
        .current-bet-info {
            color: white;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            display: none;
        }

        .current-bet-amount {
            color: var(--secondary);
            font-weight: bold;
        }
		.title {
            color: white;
            font-size: 2.5rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255,77,77,0.5);
            position: relative;
            z-index: 1;
        }

        .user-name {
            color: var(--accent);
            font-size: 1.2rem;
            text-align: center;
            margin: -10px 0 20px 0;
            padding: 5px 15px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            display: inline-block;
            animation: fadeIn 0.5s ease-in-out;
        }

        .user-name i {
            margin-right: 8px;
            color: var(--secondary);
        }

        .balance {
            position: relative;
            color: white;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            animation: fadeIn 0.3s ease-in-out;
            transition: all 0.3s ease;
        }

        #balance {
            color: var(--secondary);
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .balance:has(#balance.balance-update) {
            background: rgba(78, 204, 163, 0.2);
        }

        @keyframes balanceUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .balance-update {
            animation: balanceUpdate 0.3s ease-in-out;
        }

        .slot-machine {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 1;
            border: 1px solid var(--glass);
        }

        .timer {
            margin-top: 20px;
            text-align: center;
            color: white;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease-in-out;
        }

        .timer-text {
            font-size: 16px;
            margin-bottom: 8px;
            color: white;
        }

        .countdown {
            font-size: 20px;
            font-weight: bold;
            color: #adadad;
            animation: pulse 2s infinite;
        }

        .reels {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            perspective: 1000px;
        }

        .reel {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 20px rgba(69,183,209,0.2);
            transition: transform 0.3s ease;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .reel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes anticipation {
            0% { box-shadow: 0 0 20px rgba(255,215,0,0.3); }
            50% { box-shadow: 0 0 40px rgba(255,215,0,0.5); }
            100% { box-shadow: 0 0 20px rgba(255,215,0,0.3); }
        }

        .reel.anticipation {
            animation: anticipation 0.5s ease-in-out infinite;
        }
		@keyframes rainbowGlow {
            0% { text-shadow: 0 0 10px #ff0000; }
            16.666% { text-shadow: 0 0 10px #ff8800; }
            33.333% { text-shadow: 0 0 10px #ffff00; }
            50% { text-shadow: 0 0 10px #00ff00; }
            66.666% { text-shadow: 0 0 10px #0088ff; }
            83.333% { text-shadow: 0 0 10px #8800ff; }
            100% { text-shadow: 0 0 10px #ff0000; }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { text-shadow: 0 0 10px var(--secondary); }
            50% { text-shadow: 0 0 20px var(--secondary); }
            100% { text-shadow: 0 0 10px var(--secondary); }
        }

        .symbol.winning {
            animation: rainbowGlow 2s linear infinite;
            transform: scale(1.1);
            transition: transform 0.3s ease;
        }

        @media (min-width: 768px) {
            .reel {
                width: 100px;
                height: 100px;
            }
        }

        .symbols {
			position: absolute;
			width: 100%;
			display: flex;
			flex-direction: column;
			transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			will-change: transform;
		}

		.symbol {
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-shrink: 0;
			transform: translateZ(0);
			background: rgba(255,255,255,0.02);
		}

        .symbol:hover {
            transform: scale(1.1);
            background: rgba(255,255,255,0.05);
        }

        @media (min-width: 768px) {
            .symbol {
                height: 100px;
                font-size: 50px;
            }
        }

        .buttons {
            display: flex;
            gap: 15px;
            width: 100%;
        }

        .spins-left {
            text-align: center;
            color: white;
            font-size: 18px;
            margin-top: 15px;
            font-weight: bold;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .spins-left.low {
            color: var(--primary);
            animation: warningPulse 1.5s infinite;
        }

        .spin-button, .auto-spin-button {
            flex: 1;
            padding: 15px;
            font-size: 18px;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .spin-button {
            background: linear-gradient(45deg, var(--primary), #ff6b6b);
            box-shadow: 0 0 15px rgba(255,77,77,0.3);
        }

        .spin-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.2),
                transparent
            );
            transition: 0.5s;
        }

        .spin-button:hover::before {
            left: 100%;
        }

        .auto-spin-button {
            background: linear-gradient(45deg, var(--accent), #6be4ff);
            box-shadow: 0 0 15px rgba(69,183,209,0.3);
        }

        .auto-spin-button.active {
            background: linear-gradient(45deg, var(--secondary), #6bffb8);
            animation: pulse 1.5s infinite;
        }
		.spin-button:disabled, .auto-spin-button:disabled {
            background: #2d2d2d;
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .result {
            text-align: center;
            color: white;
            font-size: 20px;
            margin-top: 20px;
            min-height: 30px;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .spins-counter {
            text-align: center;
            color: white;
            font-size: 16px;
            margin-top: 15px;
            opacity: 0;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 8px;
        }

        .spins-counter.visible {
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes balanceChange {
            0% {
                opacity: 0;
                transform: translateY(-50%) translateX(0);
            }
            20% {
                opacity: 1;
                transform: translateY(-50%) translateX(10px);
            }
            80% {
                opacity: 1;
                transform: translateY(-50%) translateX(10px);
            }
            100% {
                opacity: 0;
                transform: translateY(-50%) translateX(30px);
            }
        }

        .balance-particle {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            font-weight: bold;
            white-space: nowrap;
        }

        @keyframes jackpotGlow {
            0% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1.2); }
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti {
            position: fixed;
            top: -20px;
            pointer-events: none;
            border-radius: 50%;
            animation: confettiFall 4s linear forwards;
        }

        .glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(255,77,77,0.2) 0%, 
                transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .slot-machine:hover .glow {
            opacity: 1;
        }

        /* Адаптивный дизайн */
        @media screen and (max-width: 320px) {
            .title {
                font-size: 1.8rem;
            }
            
            .user-name {
                font-size: 1rem;
            }
            
            .balance {
                font-size: 1.2rem;
                padding: 10px 15px;
            }
            
            .slot-machine {
                padding: 15px;
            }
            
            .reel {
				position: relative;
				overflow: hidden;
				transform-style: preserve-3d;
				will-change: transform;
			}
            @keyframes spin {
				from { transform: translateY(0); }
				to { transform: translateY(-100%); }
			}
            .symbol {
                font-size: 25px;
                height: 50px;
            }
            
            .buttons {
                gap: 8px;
            }
            
            .spin-button, .auto-spin-button {
                padding: 10px;
                font-size: 14px;
            }
        }
		@media screen and (min-width: 321px) and (max-width: 375px) {
            .title {
                font-size: 2rem;
            }
            
            .slot-machine {
                padding: 20px;
            }
            
            .reel {
                width: 60px;
                height: 60px;
            }
            
            .symbol {
                font-size: 30px;
                height: 60px;
            }
        }

        @media screen and (min-width: 376px) and (max-width: 425px) {
            .reel {
                width: 70px;
                height: 70px;
            }
            
            .symbol {
                font-size: 35px;
                height: 70px;
            }
        }

        @media screen and (min-width: 426px) and (max-width: 768px) {
            .slot-machine {
                max-width: 500px;
            }
            
            .reel {
                width: 90px;
                height: 90px;
            }
            
            .symbol {
                font-size: 45px;
                height: 90px;
            }
        }

        @media screen and (min-width: 769px) {
            .slot-machine {
                max-width: 600px;
            }
            
            .reel {
                width: 120px;
                height: 120px;
            }
            
            .symbol {
                font-size: 60px;
                height: 120px;
            }
            
            .buttons {
                gap: 20px;
            }
            
            .spin-button, .auto-spin-button {
                padding: 20px;
                font-size: 20px;
            }
        }

        @media screen and (orientation: landscape) and (max-height: 500px) {
            body {
                padding: 10px;
            }
            
            .title {
                font-size: 1.8rem;
                margin-bottom: 5px;
            }
            
            .user-name {
                margin-bottom: 10px;
            }
            
            .balance {
                margin-bottom: 10px;
            }
            
            .slot-machine {
                padding: 15px;
            }
            
            .reels {
                margin-bottom: 15px;
            }
        }

        @media screen and (min-width: 1440px) {
            .slot-machine {
                max-width: 800px;
            }
            
            .title {
                font-size: 3rem;
            }
            
            .user-name {
                font-size: 1.4rem;
            }
            
            .balance {
                font-size: 1.8rem;
            }
            
            .reel {
                width: 150px;
                height: 150px;
            }
            
            .symbol {
                font-size: 75px;
                height: 150px;
            }
            
            .spin-button, .auto-spin-button {
                padding: 25px;
                font-size: 24px;
            }
            
            .result {
                font-size: 24px;
            }
            
            .bet-selector {
                padding: 20px;
            }
            
            .bet-option {
                padding: 12px 20px;
                font-size: 18px;
            }
        }
		@media screen and (min-width: 768px) and (max-width: 1024px) {
            .slot-machine {
                max-width: 700px;
            }
            
            .bet-selector {
                max-width: 700px;
                margin: 0 auto 20px;
            }
            
            .bet-options {
                justify-content: space-around;
            }
            
            .bet-option {
                min-width: 100px;
            }
        }

        @media (hover: none) {
            .spin-button:active, .auto-spin-button:active {
                transform: scale(0.95);
            }
            
            .bet-option:active {
                background: var(--primary);
            }
        }

        @media (prefers-color-scheme: dark) {
            .bet-selector {
                background: rgba(0, 0, 0, 0.3);
            }
            
            .current-bet-info {
                background: rgba(0, 0, 0, 0.2);
            }
            
            .timer {
                background: rgba(0, 0, 0, 0.2);
            }
        }

        @media screen and (min-width: 2560px) {
            .slot-machine {
                max-width: 1000px;
            }
            
            .title {
                font-size: 4rem;
            }
            
            .user-name {
                font-size: 1.8rem;
            }
            
            .balance {
                font-size: 2.2rem;
            }
            
            .reel {
                width: 200px;
                height: 200px;
            }
            
            .symbol {
                font-size: 100px;
                height: 200px;
            }
            
            .spin-button, .auto-spin-button {
                padding: 30px;
                font-size: 28px;
            }
            
            .bet-option {
                padding: 15px 25px;
                font-size: 22px;
            }
        }

        @media print {
            .spin-button, .auto-spin-button {
                display: none;
            }
            
            .slot-machine {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .balance {
                border: 1px solid #000;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            
            .spin-button:hover, .auto-spin-button:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
	<div class="content-wrapper">
    <button class="back-button" onclick="window.location.href='index.html'">
        <i class="fas fa-arrow-left"></i>
        BACK
    </button>
    <h1 class="title">SLOT MACHINE</h1>
    <div class="user-name"></div>
    <div class="balance">Balance: <span id="balance">0</span></div>
    
    <div class="bet-selector">
        <div class="bet-label">Select Bet Amount:</div>
        <div class="bet-options">
            <button class="bet-option active" data-bet="10">10</button>
            <button class="bet-option" data-bet="50">50</button>
            <button class="bet-option" data-bet="100">100</button>
            <button class="bet-option" data-bet="250">250</button>
            <button class="bet-option" data-bet="500">500</button>
            <button class="bet-option" data-bet="1000">1000</button>
        </div>
    </div>
	<div class="current-bet-info">
        Current Bet: <span class="current-bet-amount">10</span>
    </div>

    <div class="slot-machine">
        <div class="glow"></div>
        <div class="reels">
            <div class="reel">
                <div class="symbols" id="reel1"></div>
            </div>
            <div class="reel">
                <div class="symbols" id="reel2"></div>
            </div>
            <div class="reel">
                <div class="symbols" id="reel3"></div>
            </div>
        </div>
        <div class="buttons">
            <button class="spin-button" onclick="spin()">SPIN</button>
            <button class="auto-spin-button" onclick="toggleAutoSpin()">AUTO SPIN</button>
        </div>
        <div class="result"></div>
        <div class="spins-counter"></div>
        <div class="spins-left"></div>
        <div class="timer" style="display: none;">
            <div class="timer-text">Next spins available in:</div>
            <div class="countdown"></div>
        </div>
    </div>

<script>
let tg = window.Telegram.WebApp;
let spinBet = 0; // Добавляем переменную для хранения ставки текущего спина
tg.expand();

const symbols = ['🎰', '💎', '7️⃣', '🌟', '🎲', '🍀', '👑', '🎮'];
const reels = document.querySelectorAll('.symbols');
let isSpinning = false;
let isAutoSpinning = false;
let autoSpinCount = 0;
const MAX_AUTO_SPINS = 50;
let spinsRemaining = 25;
const INITIAL_SPINS = 25;
const JACKPOT_BONUS_SPINS = 15;
const SMALL_WIN_BONUS_SPINS = 1;
const RESET_DELAY = 60 * 1000; // 45 секунд для тестирования

let currentBet = 10;
const betMultipliers = {
    '10': 1,
    '50': 5,
    '100': 10,
    '250': 25,
    '500': 50,
    '1000': 100
};

let balance = parseInt(localStorage.getItem('balance')) || 1000;

function updateBalance(amount) {
    const balanceElement = document.getElementById('balance');
    const balanceContainer = balanceElement.parentElement;
    const oldBalance = balance;
    const newBalance = oldBalance + amount;
    
    if (amount !== 0) {
        const particle = document.createElement('div');
        const balanceRect = balanceContainer.getBoundingClientRect();
        
        particle.style.cssText = `
            position: absolute;
            color: ${amount > 0 ? '#4ECCA3' : '#FF4D4D'};
            font-size: 24px;
            font-weight: bold;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            pointer-events: none;
        `;
        particle.textContent = `${amount > 0 ? '+' : ''}${amount}`;
        balanceContainer.appendChild(particle);

        particle.animate([
            {
                opacity: 0,
                transform: 'translateY(-50%) translateX(0)'
            },
            {
                opacity: 1,
                transform: 'translateY(-50%) translateX(10px)'
            },
            {
                opacity: 1,
                transform: 'translateY(-50%) translateX(10px)'
            },
            {
                opacity: 0,
                transform: 'translateY(-50%) translateX(30px)'
            }
        ], {
            duration: 1500,
            easing: 'ease-out'
        });

        setTimeout(() => particle.remove(), 1500);
    }

    balance = newBalance;
    balanceElement.textContent = balance;
    localStorage.setItem('balance', balance.toString());
    updateBetButtons();
}
function toggleBetSelector() {
    const betSelector = document.querySelector('.bet-selector');
    const currentBetInfo = document.querySelector('.current-bet-info');
    
    if (spinsRemaining <= 0) {
        betSelector.style.display = 'block';
        currentBetInfo.style.display = 'block';
    } else {
        betSelector.style.display = 'none';
        currentBetInfo.style.display = 'none';
    }
}

function calculateWinAmount(symbols) {
    const [first, second, third] = symbols;
    
    if (spinsRemaining > 0) {
        // Логика для free spins остается прежней
        if (first === '🎲' && second === '🎲' && third === '🎲') {
            return 1000;
        }
        
        if (first === second && second === third) {
            return 100;
        }
        
        if ((first === '🎲' && second === '🎲') || (second === '🎲' && third === '🎲')) {
            return 100;
        }
        
        if (first === second || second === third) {
            return 15;
        }
        
        return 0;
    } else {
        // Используем сохраненную ставку spinBet вместо currentBet
        const multiplier = betMultipliers[spinBet.toString()];
        
        if (first === '🎲' && second === '🎲' && third === '🎲') {
            return 1000 * multiplier;
        }
        
        if (first === second && second === third) {
            return 100 * multiplier;
        }
        
        if ((first === '🎲' && second === '🎲') || (second === '🎲' && third === '🎲')) {
            return 100 * multiplier;
        }
        
        if (first === second || second === third) {
            return 15 * multiplier;
        }
        
        return 0;
    }
}

function updateBetButtons() {
    const betButtons = document.querySelectorAll('.bet-option');
    betButtons.forEach(button => {
        const betAmount = parseInt(button.dataset.bet);
        if (balance < betAmount) {
            button.classList.add('disabled');
        } else {
            button.classList.remove('disabled');
        }
    });
}

function initBetSelector() {
    const betOptions = document.querySelectorAll('.bet-option');
    betOptions.forEach(option => {
        option.addEventListener('click', () => {
            const betAmount = parseInt(option.dataset.bet);
            if (balance >= betAmount) {
                betOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentBet = betAmount;
                updateCurrentBetDisplay();
            }
        });
    });
}

function updateCurrentBetDisplay() {
    const currentBetDisplay = document.querySelector('.current-bet-amount');
    if (currentBetDisplay) {
        currentBetDisplay.textContent = currentBet;
    }
}

function saveNextResetTime() {
    const nextReset = Date.now() + RESET_DELAY;
    localStorage.setItem('nextSpinsReset', nextReset.toString());
}

function getTimeRemaining() {
    const nextReset = parseInt(localStorage.getItem('nextSpinsReset'));
    if (!nextReset) return 0;
    
    const remaining = nextReset - Date.now();
    return remaining > 0 ? remaining : 0;
}

function formatTime(ms) {
    const hours = Math.floor(ms / (1000 * 60 * 60));
    const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((ms % (1000 * 60)) / 1000);
    
    const hoursStr = hours.toString().padStart(2, '0');
    const minutesStr = minutes.toString().padStart(2, '0');
    const secondsStr = seconds.toString().padStart(2, '0');
    
    return `${hoursStr}:${minutesStr}:${secondsStr}`;
}
function updateTimer() {
    const timerElement = document.querySelector('.timer');
    const countdownElement = document.querySelector('.countdown');
    const remaining = getTimeRemaining();
    
    if (remaining <= 0) {
        timerElement.style.display = 'none';
        spinsRemaining = INITIAL_SPINS;
        localStorage.removeItem('freeSpinsEndMessageShown');
        updateSpinsLeft();
        localStorage.removeItem('nextSpinsReset');
        enableButtons();
    } else {
        timerElement.style.display = 'block';
        countdownElement.textContent = formatTime(remaining);
        if (balance >= currentBet) {
            enableButtons();
        }
        setTimeout(updateTimer, 1000);
    }
}

function enableButtons() {
    const spinButton = document.querySelector('.spin-button');
    const autoSpinButton = document.querySelector('.auto-spin-button');
    
    if (spinsRemaining > 0 || balance >= currentBet) {
        spinButton.disabled = false;
        autoSpinButton.disabled = false;
    } else {
        spinButton.disabled = balance < currentBet;
        autoSpinButton.disabled = balance < currentBet;
    }
}

function disableButtons() {
    const spinButton = document.querySelector('.spin-button');
    const autoSpinButton = document.querySelector('.auto-spin-button');
    spinButton.disabled = true;
    autoSpinButton.disabled = true;
}

function createConfetti() {
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffd700'];
    const confettiCount = 150;

    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.animationDelay = Math.random() * 2 + 's';
        const size = Math.random() * 8 + 4;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        document.body.appendChild(confetti);
        
        confetti.addEventListener('animationend', () => {
            confetti.remove();
        });
    }
}

function createSymbolsString() {
    // Добавляем дополнительные символы для плавного перехода
    let symbolsString = '';
    for (let i = 0; i < 4; i++) { // Увеличиваем количество повторений
        symbols.forEach(symbol => {
            symbolsString += `<div class="symbol">${symbol}</div>`;
        });
    }
    return symbolsString;
}

function initReels() {
    reels.forEach(reel => {
        let symbolsHtml = '';
        for (let i = 0; i < 3; i++) {
            symbolsHtml += createSymbolsString();
        }
        reel.innerHTML = symbolsHtml;
        reel.style.transform = 'translateY(0)';
    });
}

function getVisibleSymbol(reel) {
    const symbolHeight = getSymbolHeight();
    const transform = reel.style.transform;
    const translateY = parseInt(transform.match(/-?\d+/)[0]);
    const totalSymbols = symbols.length;
    const visibleIndex = Math.abs(Math.round(translateY / symbolHeight) % totalSymbols);
    return symbols[visibleIndex];
}

function updateSpinsLeft() {
    const spinsLeftElement = document.querySelector('.spins-left');
    spinsLeftElement.textContent = `Spins Left: ${spinsRemaining}`;
    
    if (spinsRemaining <= 5) {
        spinsLeftElement.classList.add('low');
    } else {
        spinsLeftElement.classList.remove('low');
    }
    
    toggleBetSelector();
	if (spinsRemaining === 0 && !localStorage.getItem('freeSpinsEndMessageShown')) {
        if (isAutoSpinning) {
            stopAutoSpin();
        }
        
        const result = document.querySelector('.result');
        result.innerHTML = `
            <div style="animation: fadeIn 0.3s forwards">
                Free Spins Ended! Select your bet to continue playing.
            </div>`;
        result.style.color = '#45B7D1';
        
        localStorage.setItem('freeSpinsEndMessageShown', 'true');
        saveNextResetTime();
        updateTimer();
    }

    localStorage.setItem('spinsRemaining', spinsRemaining.toString());
}

function determineOutcome() {
    const random = Math.random();
    
    if (random < 0.01) {
        const symbol = symbols[Math.floor(Math.random() * symbols.length)];
        return [symbol, symbol, symbol];
    }
    
    if (random < 0.15) {
        const symbol1 = symbols[Math.floor(Math.random() * symbols.length)];
        const position = Math.random() < 0.5 ? 0 : 1;
        
        let remainingSymbol;
        do {
            remainingSymbol = symbols[Math.floor(Math.random() * symbols.length)];
        } while (remainingSymbol === symbol1);

        if (position === 0) {
            return [symbol1, symbol1, remainingSymbol];
        } else {
            return [remainingSymbol, symbol1, symbol1];
        }
    }
    
    return generateRandomCombination();
}

function generateRandomCombination() {
    let result = [];
    let lastSymbol = null;
    
    for (let i = 0; i < 3; i++) {
        let nextSymbol;
        do {
            nextSymbol = symbols[Math.floor(Math.random() * symbols.length)];
        } while (nextSymbol === lastSymbol);
        
        result.push(nextSymbol);
        lastSymbol = nextSymbol;
    }
    
    return result;
}

function addSpinEffect(reel) {
    reel.style.filter = 'blur(2px)';
    reel.parentElement.style.transform = 'scale(0.95)';
}

function removeSpinEffect(reel) {
    reel.style.filter = 'none';
    reel.parentElement.style.transform = 'scale(1)';
}

function createJackpotEffect(element) {
    const container = document.createElement('div');
    container.style.cssText = `
        position: absolute;
        left: ${element.offsetLeft}px;
        top: ${element.offsetTop}px;
        width: ${element.offsetWidth}px;
        height: ${element.offsetHeight}px;
        pointer-events: none;
        z-index: 999;
    `;
    document.body.appendChild(container);
    setTimeout(() => container.remove(), 2000);
}
function checkResult() {
    const visibleSymbols = Array.from(reels).map(reel => getVisibleSymbol(reel));
    
    document.querySelectorAll('.symbol.winning').forEach(symbol => {
        symbol.classList.remove('winning');
    });

    reels.forEach((reel, index) => {
        const symbolElements = reel.children;
        const visibleSymbolElement = symbolElements[Math.floor(symbolElements.length / 2)];
        
        if (visibleSymbolElement) {
            if (visibleSymbols[0] === visibleSymbols[1] && visibleSymbols[1] === visibleSymbols[2]) {
                if (index < 3) {
                    visibleSymbolElement.classList.add('winning');
                }
            } else if (
                (visibleSymbols[0] === visibleSymbols[1] && (index === 0 || index === 1)) ||
                (visibleSymbols[1] === visibleSymbols[2] && (index === 1 || index === 2))
            ) {
                visibleSymbolElement.classList.add('winning');
            }
        }
    });

    const result = document.querySelector('.result');
    const slotMachine = document.querySelector('.slot-machine');
    const winAmount = calculateWinAmount(visibleSymbols);
    
    if (winAmount > 0) {
        updateBalance(winAmount);
    }

    // Проверка на джекпот (3 одинаковых символа)
    if (visibleSymbols[0] === visibleSymbols[1] && visibleSymbols[1] === visibleSymbols[2]) {
        const isJackpotDice = visibleSymbols[0] === '🎲';
        if (spinsRemaining > 0) {
            spinsRemaining += JACKPOT_BONUS_SPINS;
        }
        
        createJackpotEffect(slotMachine);
        
        result.innerHTML = `
            <div style="animation: jackpotWin 0.5s ease-in-out 3">
                🎉 JACKPOT! 🎉<br>
                <span style="font-size: 0.8em; color: var(--secondary)">
                    ${spinsRemaining > 0 ? `+${JACKPOT_BONUS_SPINS} spins<br>` : ''}
                    +${winAmount} ${spinsRemaining > 0 ? 'points' : 'coins'}
                </span>
            </div>`;
        result.style.color = '#ffd700';
        
        createConfetti();
        slotMachine.style.animation = 'jackpotWin 0.5s ease-in-out 3';

    // Проверка на малый выигрыш (2 одинаковых символа рядом)
    } else if (visibleSymbols[0] === visibleSymbols[1] || visibleSymbols[1] === visibleSymbols[2]) {
        const isDiceWin = (visibleSymbols[0] === '🎲' && visibleSymbols[1] === '🎲') || 
                         (visibleSymbols[1] === '🎲' && visibleSymbols[2] === '🎲');
        if (spinsRemaining > 0) {
            spinsRemaining += SMALL_WIN_BONUS_SPINS;
        }
        
        result.innerHTML = `
            <div style="animation: smallWin 0.5s ease-in-out 2">
                🎈 Small Win! 🎈<br>
                <span style="font-size: 0.8em; color: var(--accent)">
                    ${spinsRemaining > 0 ? `+${SMALL_WIN_BONUS_SPINS} spin<br>` : ''}
                    +${winAmount} ${spinsRemaining > 0 ? 'points' : 'coins'}
                </span>
            </div>`;
        result.style.color = '#98fb98';
        slotMachine.style.animation = 'smallWin 0.5s ease-in-out 2';
    } else {
        result.innerHTML = `
            <div style="opacity: 0; animation: fadeIn 0.3s forwards">
                Try Again!
            </div>`;
        result.style.color = 'white';
    }
    
    setTimeout(() => {
        slotMachine.style.animation = '';
    }, 1500);
    
    updateSpinsLeft();
}
function getSymbolHeight() {
    const width = window.innerWidth;
    if (width < 321) return 50;
    if (width < 376) return 60;
    if (width < 426) return 70;
    if (width < 769) return 90;
    if (width < 1440) return 120;
    return 150;
}
function spin() {
    if (isSpinning) return;
    
    if (spinsRemaining <= 0) {
        if (balance < currentBet) return;
        spinBet = currentBet; // Сохраняем ставку в момент начала спина
    } else {
        spinBet = 0; // Для free spins ставка 0
    }
    
    // Блокируем возможность менять ставку во время спина
    document.querySelectorAll('.bet-option').forEach(btn => {
        btn.disabled = true;
    });
    
    if (spinsRemaining > 0) {
        spinsRemaining--;
    } else {
        updateBalance(-spinBet);
    }
    
    updateSpinsLeft();
    isSpinning = true;
    
    const button = document.querySelector('.spin-button');
    const autoSpinButton = document.querySelector('.auto-spin-button');
    const result = document.querySelector('.result');
    
    if (!isAutoSpinning) {
        button.disabled = true;
    }
    result.textContent = '';

    const symbolHeight = getSymbolHeight();
    let finalSymbols = determineOutcome();
    let reelStoppedCount = 0;

    reels.forEach((reel, index) => {
        addSpinEffect(reel);
        
        reel.style.transition = 'none';
        reel.style.transform = 'translateY(0)';
        
        reel.offsetHeight;

        const extraSpins = 2;
        const totalSymbols = symbols.length;
        const symbolIndex = symbols.indexOf(finalSymbols[index]);
        const finalPosition = -(symbolIndex * symbolHeight);
        const totalDistance = (extraSpins * totalSymbols * symbolHeight) + finalPosition;
        
        let spinDuration = 2 + (index * 0.5);
        let timingFunction = 'cubic-bezier(.17,.67,.12,.99)';
        
        const startDelay = index * 400;
        setTimeout(() => {
            reel.style.transition = `transform ${spinDuration}s ${timingFunction}`;
            reel.style.transform = `translateY(${-totalDistance}px)`;

            setTimeout(() => {
                removeSpinEffect(reel);
                reelStoppedCount++;

                if (reelStoppedCount === 2) {
                    const firstSymbol = getVisibleSymbol(reels[0]);
                    const secondSymbol = getVisibleSymbol(reels[1]);

                    if (firstSymbol === secondSymbol) {
                        reels[2].style.transition = 'transform 4s cubic-bezier(0.1, 0.7, 0.2, 1)';
                        
                        const anticipationEffect = () => {
                            const lastReel = reels[2].parentElement;
                            lastReel.classList.add('anticipation');
                            
                            setTimeout(() => {
                                lastReel.classList.remove('anticipation');
                            }, 500);
                        };

                        for(let i = 0; i < 3; i++) {
                            setTimeout(anticipationEffect, i * 600);
                        }
                    }
                }
            }, spinDuration * 1000);
        }, startDelay);
    });

    const totalSpinTime = 4500;
    setTimeout(() => {
		isSpinning = false;
		
		// Разблокируем кнопки ставок
		document.querySelectorAll('.bet-option').forEach(btn => {
			btn.disabled = false;
		});
        
        if (!isAutoSpinning) {
            if (spinsRemaining > 0 || balance >= currentBet) {
                button.disabled = false;
            } else {
                button.disabled = true;
                if (spinsRemaining === 0) {
                    const result = document.querySelector('.result');
                    result.innerHTML = `
                        <div style="animation: fadeIn 0.3s forwards">
                            Free Spins Ended! Select your bet to continue playing.
                        </div>`;
                    result.style.color = '#45B7D1';
                    stopAutoSpin();
                }
            }
        }
        
        checkResult();
        enableButtons();
        
    }, totalSpinTime);
}
function toggleAutoSpin() {
    const autoSpinButton = document.querySelector('.auto-spin-button');
    const spinButton = document.querySelector('.spin-button');
    
    if (!isAutoSpinning) {
        if (spinsRemaining <= 0 && balance < currentBet) return;
        
        isAutoSpinning = true;
        autoSpinCount = 0;
        autoSpinButton.classList.add('active');
        autoSpinButton.innerHTML = '<span style="display: inline-block; animation: pulse 1s infinite">STOP AUTO</span>';
        spinButton.disabled = true;
        updateSpinsCounter();
        
        if (!isSpinning) {
            performAutoSpin();
        }
    } else {
        stopAutoSpin();
    }
}

function performAutoSpin() {
    if (!isAutoSpinning) return;
    
    if (autoSpinCount >= MAX_AUTO_SPINS) {
        stopAutoSpin();
        return;
    }

    if (spinsRemaining <= 0 && balance < currentBet) {
        stopAutoSpin();
        return;
    }

    if (!isSpinning) {
        spin();
        autoSpinCount++;
        updateSpinsCounter();
        setTimeout(() => {
            if (isAutoSpinning) {
                performAutoSpin();
            }
        }, 5000);
    }
}

function stopAutoSpin() {
    isAutoSpinning = false;
    const autoSpinButton = document.querySelector('.auto-spin-button');
    const spinButton = document.querySelector('.spin-button');
    const spinsCounter = document.querySelector('.spins-counter');
    
    autoSpinButton.classList.remove('active');
    autoSpinButton.textContent = 'AUTO SPIN';
    
    if ((spinsRemaining > 0 || balance >= currentBet) && !isSpinning) {
        spinButton.disabled = false;
    }
    spinsCounter.classList.remove('visible');
}

function updateSpinsCounter() {
    const spinsCounter = document.querySelector('.spins-counter');
    spinsCounter.textContent = `Auto Spins: ${autoSpinCount}`;
    spinsCounter.classList.add('visible');
}

window.addEventListener('load', () => {
    const userNameElement = document.querySelector('.user-name');
    if (tg.initDataUnsafe?.user?.username) {
        userNameElement.innerHTML = `<i class="fas fa-user"></i>@${tg.initDataUnsafe.user.username}`;
    } else if (tg.initDataUnsafe?.user?.first_name) {
        userNameElement.innerHTML = `<i class="fas fa-user"></i>${tg.initDataUnsafe.user.first_name}`;
    } else {
        userNameElement.innerHTML = `<i class="fas fa-user"></i>Guest`;
    }

    userNameElement.style.opacity = '0';
    setTimeout(() => {
        userNameElement.style.opacity = '1';
    }, 100);

    document.getElementById('balance').textContent = balance;
    
    const remaining = getTimeRemaining();
    if (remaining > 0) {
        spinsRemaining = 0;
        updateSpinsLeft();
        updateTimer();
    } else {
        const savedSpins = localStorage.getItem('spinsRemaining');
        if (savedSpins !== null) {
            spinsRemaining = parseInt(savedSpins);
        } else {
            spinsRemaining = INITIAL_SPINS;
        }
        updateSpinsLeft();
    }
    
    initReels();
    initBetSelector();
    updateBetButtons();
    updateCurrentBetDisplay();
    toggleBetSelector();
});
</script>
</body>
</html>
